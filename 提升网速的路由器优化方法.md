# 提升网速的路由器优化方法

- **防蹭网**
- **开启 UPnP**
- **QoS 与网络限速**
- **设置正确的 MTU 值**
- **使用路由器交换机模式**
- **使用无线中继扩展 Wi-Fi 信号**

## 1、防蹭网

这是最最首要的一条：**确认没有陌生人在蹭网！**

被蹭网意味着你的 Wi-Fi 密码被泄露（看看是不是不小心用万能钥匙把自家 Wi-Fi 共享出去了？），或者你的路由器已经被入侵。入侵者如果稍微懂一点黑客技术的话（「猫哥学前班」以后也会介绍），只需通过 DNS 劫持或 [ARP 欺骗](http://baike.baidu.com/view/155386.htm)技术，就能轻松获取你所有的上网信息和账户密码。

我们可以先通过以下方式，确认自家 Wi-Fi 的安全性。

### 进入路由器管理后台

参考以下截图，在手机的 Wi-Fi 网络设置中找到路由器的 IP 地址，一般默认 IP 是 `192.168.1.1`

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100223526-596149511-1689047271969-3.png" alt="img" style="zoom:80%;" />

------

用浏览器打开以上 IP 地址（本例中为 http://192.168.199.1/ ），在弹出的登录窗口中，输入用户名和密码。如果确认自己没有设置过，那可以尝试默认的用户名 `admin` 和密码 `admin`。

如果提示密码错误，可以查看路由器设备背面标签，上面有注明初始的用户名和密码。如果依然提示密码错误，说明你的路由器已经被人入侵过了，可以长按路由器上的 reset 按钮超过 10 秒，进行初始化重置。

注意：宽带拨号用户在初始化重置之前，请先确认有记录好宽带账号和密码

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100237558-133388449.jpg" alt="img" style="zoom:80%;" />

------

**如果你的路由器密码一直用的默认的 admin，一定要重新设置一个较复杂的密码。因为大部分路由器的安全性做的并不好，通过简单的 [CSRF 技术](http://baike.baidu.com/view/1609487.htm)就能轻松劫持路由器的 DNS。**

###  查看「设备管理」

在路由器的管理后台中，有一个「连接设备」或「客户端列表」的界面，点进去后就可以查看到所有连接到该台路由器上的联网设备，包括手机、电脑、路由、电视盒等等。

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100251214-273037141.png" alt="img" style="zoom:80%;" />

------

找找看，是不是每台设备你都认识。如果发现有陌生设备，那说明你的 Wi-Fi 已经泄露了，赶紧重设一个 Wi-Fi 密码先！

注意：路由器后台密码和 Wi-Fi 密码是两个概念，当然你也可以把两个密码设置成一样的。

在无线 Wi-Fi 密码设置界面中，通常有个选项是选择加密算法，**记住一定不要选择 WEP 加密。**因为这种模式很容易被程序暴力破解，八位长度以下的密码分分钟就能破解掉。

设置好密码之后，我们再来看看其他的路由器优化方法。如果看不懂的话也没关系，因为即使看懂了也很可能用不上：）

## 2、开启 UPnP

**如果有经常挂机下载岛国爱情动作片的习惯，那应该特别留意这条优化方法，因为它通常能够挑战宽带的极限速度。**

先普及个宽带常识，假如你办的宽带套餐是 20M，但发现迅雷下载速度只有 2.5M/s，并没有到达 20M/s，这是正常的，因为二者的计算单位不同。

宽带运营商所说的 20M 是指「每秒比特数」为 20 兆（即 20M bps），而软件下载速度 2.5M/s 指的是「每秒字节数」为 2.5 兆（即 2.5M Bps）。其中的小 b 为 bits，大 B 为 Bytes，换算方法为 ：8 bits = 1Bytes，1KB = 1024 Bytes，1024KB = 1M。

但实际情况是，你的下载速度通常都达不到理论最大值（即使你已经开了迅雷 VIP 会员）。因为路由器作为局域网网关，需要同时处理局域网内所有上网设备的流量负载与分发，会导致在流量管理上出现一定的损耗。

**这时，我们可以尝试开启路由器的 UPnP 功能，它能够让上网设备直接通过端口映射的方式连接外网，减少在局域网环节的性能损耗，从而提升下载速度。**

登录路由器管理后台，在转发规则、端口映射或高级设置菜单中找到一个「UPnP 设置 」的选项，将其设置为「开启」状态，再试试下载速度是否有所提升。

## 3、QoS 与网络限速

如果局域网内的某些设备经常挂迅雷下载，就会影响其他设备的上网和游戏体验，通过 QoS 和网络限速可以解决这一问题。

**在路由器的管理后台中，找到并开启 QoS 设置。开启后，路由器能「自动」将流量「合理地」分配给需要的上网设备，从而避免整个局域网出现网络拥堵的情况。**

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100305745-560024049.png" alt="img" style="zoom:50%;" />

------

通常设置 QoS 的时候，会要求填写「上行带宽」和「下行带宽」，也就是所办宽带套餐的最大上传速度和最大下载速度。这两个值可以通过「QQ 电脑管家」的网络测速工具，或者百度上搜索「宽带测速」进行在线测试。测试的时候，记得断掉其他的上网设备，确保能测到准确的最大值。

另外填写的时候，注意认清默认的流量单位，是大 B 还是小 b，是 Kb 还是 Mb，具体换算规则参看上一章节。

某些路由器会提供基于 IP 或 MAC 地址的限速功能，开启后能限制某台设备的最大下载和上传带宽。但如果开启的话，会同时增加路由器流量分发规则的复杂度，带来一定的性能损耗。所以一般来说，如果你和其他使用宽带的人没有什么血海深仇的话，**最好不要开启 IP 网络限速功能，使用 QoS 即可。**

## 4、MTU 设置

**这条规则不大常用，如果没有出现连接 VPN 后「打开百度很快，但其他网站很慢」的奇特现象，或者没有使用多台路由器组建子网的情况，那就请务必不要使用该条策略。**

以上问题通常是由于路由器的 MTU 值设置不合理引起的，一般来说，使用 VPN 时，[应当把 MTU 设置在 1444 左右](http://imomi.info/article/mtu)；其他情况下将所有路由器的 MTU 值统一设置为 1500 。

MTU 的全称是 Maximum Transmission Unit，即数据帧的「最大传输单元」。当我们玩游戏、看直播、聊微信的时候，我们的操作会被应用程序封装成一个个数据包。网卡将这些数据包传输给路由器，路由器再通过以太网将数据包传输给目标服务器。

这些数据包有大有小，为了确保网络的最大化传输效率，超过一定大小的数据包在数据链路层（通常指 Ethernet 层，参看 [OSI 七层模型](http://baike.baidu.com/view/486949.htm)）会被切分成一个个数据帧。[Ethernet （以太网）标准规定一个数据帧的最大值为 1518 字节](https://zhuanlan.zhihu.com/p/21318925)，除去 Ethernet 协议层所占用的 18 字节后（6 字节来源 MAC 地址 + 6 字节目标 MAC 地址 + 2 字节协议类型 + 4 字节协议结束标识 FCS），剩下的 1500 字节即是 MTU，它通常是指 IP 协议层及其 Payload 数据。

------

![img](D:\Typora文件导出\编辑图片保存\520689-20160824100319605-1034440093.jpg)

------

早期国内的 ADSL 宽带拨号采用的是 PPPoE 协议（Point to Point Protocol over Ethernet），该协议需要额外占用 IP 层 8 个字节用于标识 PPP 协议，所以传统的 TP-LINK 路由器的默认 MTU 为 1492 字节（1500 - 8）。但如今大部分家庭和企业都是使用的光纤入户或光猫拨号，因此直接保持 MTU 为 1500 能确保最快的上网体验。

而使用 VPN 之后，各种协议的标识头封装变得更加复杂，如果遇到 MTU 引起的上网问题，[通常需要使用 ping 工具来检测出最合适的 MTU 值](http://www.dslreports.com/faq/695)。

如下图，通过 ping 命令（注意 -f 后面的参数是字母 l 不是数字 1），我们能发现当数据包为 1472 字节时可以恰好不用拆包直接一次传输。由于 ping 命令使用的是基于 IP 协议之上的 ICMP 协议，所以 MTU = 1472 字节 + 8 字节 ICMP 协议头 + 20 字节 IP 协议头 = 1500 字节。

------

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100330917-776514549.png" alt="img" style="zoom:75%;" />

------



## 5、使用路由器交换机模式

当联网设备较多、网络覆盖区域较大的时候，通常都需要组建子网。使用路由器「交换机模式」接入法，会比常见的 「WAN-LAN-WAN 级联」接入法的性能更优。

如下图，左图为「交换机模式」接入法，将父路由器 A 的 WAN 口（通常为蓝色）直接连接光纤或拨号猫，LAN 口与子路由器 B 的 LAN 口进行连接；右图为「WAN-LAN-WAN 级联」接入法，将父路由器 A 的 LAN 口与子路由器 B 的 WAN 口进行连接，从而组成子网。

------

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100342605-273376432.jpg" alt="img" style="zoom:67%;" />

------

当使用「交换机模式」时，连接路由器 B 的设备在物理层上与连接路由 A 的设备出于同一网段，所以网络传输效率更高。

使用「交换机模式」之前，需注意将电脑单独连接路由器 B（LAN 口），进行以下设置：

1. 登录路由器 B 管理后台，关闭 DHCP 服务，避免开启多个 DHCP 服务器造成的 IP 冲突问题；
2. 将路由器 B 的 IP 分配方式改为「自动分配」。

## 6、使用无线中继扩展 Wi-Fi 信号

一般来说，将无线路由器摆在房屋中间位置，能达到最佳的信号覆盖效果。但如果某些区域信号不强，则需要加多一个无线路由器或无线中继器来扩展 Wi-Fi 的覆盖范围。

无线中继器的原理可参考下图（图片借鉴自极路由中继说明图）：

<img src="D:\Typora文件导出\编辑图片保存\520689-20160824100354386-206607229.jpg" alt="img" style="zoom:67%;" />

------

当无线 Wi-Fi 信号无法覆盖到 B 点时，可以通过在 Wi-Fi 可覆盖的范围内部署一个无线中继器，来达到信号扩展的效果，从而将信号「中继」至 B 点。

大部分的路由器都具有无线中继功能，配置方式也比较简单。在路由器管理后台的无线网络设置中，开启「无线中继」模式，扫描需要被中继的 Wi-Fi 信号，勾选之后输入 Wi-Fi 密码即可扩展成功。由于各个路由器厂商的设置方法存在较大差异，具体方法请自行百度。

**以上六种路由器优化方法中，通常我们只需关注方法 1 中提到的路由器安全问题。**

**在路由器的选用方面，需要针对不同使用场景选择不同功能的路由器，才能让网络架构和体验更加符合实际的要求。如果是办公环境使用，一般选择 TP-LINK 、磊科（netcore）、水星（MERCURY）、网件（NETGEAR）等传统企业路由器；如果是居家环境使用，则建议选择极路由、小米、魅族等智能路由器品牌，其后台管理与配置会更加简单方便。**

# 路由器中的UPnP状态开启跟关闭有什么区别

路由器中的[UPnP](https://so.csdn.net/so/search?q=UPnP&spm=1001.2101.3001.7020)状态开启跟关闭区别为：安全性不同、NAT数据转换效率不同、路由器运行不同。

## 一、安全性不同

**1、UPnP状态开启：UPnP状态开启会自动接受来自其他网络的[远程控制](https://so.csdn.net/so/search?q=远程控制&spm=1001.2101.3001.7020)，安全性低。**

**2、UPnP状态关闭：UPnP状态关闭不会自动接受来自其他网络的远程控制，安全性高。**

## 二、NAT[数据转换](https://so.csdn.net/so/search?q=数据转换&spm=1001.2101.3001.7020)效率不同

**1、UPnP状态开启：UPnP状态开启可以使网关或路由器的NAT模块做自动端口映射，加快NAT数据转换效率。**

**2、UPnP状态关闭：UPnP状态关闭不可以使网关或路由器的NAT模块做自动端口映射，不能加快NAT数据转换效率。**

------

![img](D:\Typora文件导出\编辑图片保存\335b20adf4b34d68b3dc47d11f3fa063.png)

------

## 三、路由器运行不同

**1、UPnP状态开启：UPnP状态开启会使路由器的底层系统一直在运行。**

**2、UPnP状态关闭：UPnP状态关闭不会使路由器的底层系统一直在运行。**